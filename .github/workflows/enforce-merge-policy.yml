name: Enforce merge policy

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  enforce:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR source ‚Üí target
        shell: bash
        run: |
          BASE="${{ github.event.pull_request.base.ref }}"
          HEAD="${{ github.event.pull_request.head.ref }}"

          echo "üîÄ PR: $HEAD ‚Üí $BASE"

          # Rule 1: main only accepts release/* or hotfix/*
          if [[ "$BASE" == "main" ]]; then
            if [[ "$HEAD" != release/* && "$HEAD" != hotfix/* ]]; then
              echo "‚ùå Only release/* or hotfix/* may merge into main"
              exit 1
            fi
          fi

          # Rule 2: develop accepts everything except main
          if [[ "$BASE" == "develop" ]]; then
            if [[ "$HEAD" == "main" ]]; then
              echo "‚ùå main must not merge into develop"
              exit 1
            fi
          fi

          # Rule 3 (optional): restrict PR targets
          if [[ "$BASE" != "main" && "$BASE" != "develop" ]]; then
            echo "‚ùå PRs may only target main or develop"
            exit 1
          fi

          echo "‚úÖ Merge policy satisfied"